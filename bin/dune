(melange.emit
 (target exe)
 (alias exe)
 (libraries shared)
 (preprocess
  (pps melange.ppx))
 (module_systems
  (es6 mjs))
 (runtime_deps bin.mjs node-loader.mjs))

(rule
 (alias gen_install_sexp)
 (deps (alias_rec exe) generate_install_sexp.sh)
 (target install.sexp)
 (mode promote)
 (action
  (with-stdout-to
   %{target}
   (bash ./%{deps}))))

(include install.sexp)
