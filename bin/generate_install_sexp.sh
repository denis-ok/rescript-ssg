#!/bin/bash

folders=(
  "exe/node_modules/rescript-ssg.shared/"
  "exe/node_modules/melange"
  "exe/node_modules/melange.js"
  "exe/node_modules/melange.belt"
)

echo "; GENERATED BY generate_install_sexp.sh --- DON'T EDIT MANUALLY

(install
 (section bin)
 (files
  (exe/bin/Bin.mjs as Bin.mjs)
  (exe/bin/bin.mjs as rescript-ssg)
  exe/bin/node-loader.mjs"

for folder in "${folders[@]}"; do
  # Check if the folder exists before processing it
  if [ -d "$folder" ]; then
    # Use find to locate all .mjs files in the folder
    find "$folder" -type f -name "*.mjs" | while read -r file; do
      # Remove the 'exe/' prefix from the file path
      relative_path="${file#exe/}"
      # Print the desired output line with the correct relative path
      echo "  ($file as ${file#exe/})"
    done
  else
    echo "Folder $folder does not exist."
  fi
done

echo "))"

